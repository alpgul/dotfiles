[filter "sops"]
required = true
; we decrypt files as usual, without any additional magic, there are no tricks here
smudge = sops decrypt --filename-override "%f"
; but enctyption will regenerate file even if there are no changes,
; so we need to decrypt existing file first, and perform encryption only if decrypted content is different
clean = scripts/sops-clean-filter.sh "%f"

[diff "sops"]
; and as the last piece, we need to convert the file
; but as the local file is decrypted already, we need to fail safely to just printing it
textconv = sh -c 'sops decrypt "$0" 2>/dev/null || cat "$0"'
cachetextconv = false